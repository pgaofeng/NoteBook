---
title: PCM音频数据
date: 2023-09-06 19:21:34
categories: Third Libraries
tags:
 - PCM
banner_img: img/cover/cover-pcm.webp
---

声音也称为声波，实际上就是在空气中传播的一种波，是由物体震动而产生的。不同的波形在人耳听来是有不同的声音的，因此想要将声音录制下来，实际上就是将波形录制下来。

### 声波

人耳的听力范围是`20Hz`~`20kHz`，即在这个范围内的声波才能被人听到，其他频率的都属于是次声波和超声波了。而我们录制声音，其实就是录制声波，将声波写入到文件中去，此时所做的就是将声波转换成数字信号。

### 采样率

想要记录一个波形，就需要给波形界定一个坐标系，然后记录该波形。而因为声波通常是没有固定的形状的，因此无法通过数学函数进行记录，只能使用原始的记录方法，即记录波形上的每个点的坐标，坐标点即是采样点。但声波上的点是无限的，无法全部记录下来，因此就需要相隔固定的距离后记录一个点，整体下来就是一个波形了（ 此时这个波形是虚线波）。采样率就是每秒采样的个数，即每秒钟的波形上我们记录几个坐标点，采样率越高记录的坐标点越多。

人耳的听力范围是`20Hz`~`20kHz`，根据香农公式的定义，为了不失真地恢复模拟信号，采样频率应大于等于模拟信号频谱中最高频率的2倍，因此最合适的采样率应该是`40kHz`，而因为历史的音频设备原因，最终标准的采样率被定为了`44.1kHz`。

当然，为了追求更加无损的数据，我们可以继续将采样率提高，但这样也会导致文件占用太多的存储空间，需要根据具体场景去设置采样率，常用的有`8kHz`、`24kHz`、`32kHz`、`44.1kHz`、`48kHz`、`96kHz`等。

### 采样大小

声波既然是波就有波峰和波谷，也就是我们记录坐标点时的`y`坐标的最大值和最小值，记录该数据需要使用对应的存储空间，常用的有`8bit`、`16bit`、`24bit`、`32bit`等。不同的比特长度能够记录数的大小也不相同，因此需要根据实际情况选择采样大小。

### 码率

码率即单位时长内的传输大小，对应在声音文件中即`码率=采样率*采样大小`，但音频通常不是单通道的，因此`码率=采样率*采样大小*通道数`，而文件大小即为`码率*时长`。

### PCM

`pcm`就是音频数据的原始格式，即每个采样点会直接写入到文件中，这个文件就是`pcm`文件。通常情况下我们不能直接播放`pcm`音频文件，因为我们不知道对应的采样率采样大小等信息，而`wav`格式的音频，会将采样率等这些信息全部放在文件头中，后面再接`pcm`文件，这样就可以直接播放`wav`了。

但是，`pcm`是属于原始音频数据的，记录的是每个采样点的数据，因此文件占用的存储空间非常大。因而就有了各种压缩方式和封装方式，如`mp3`、`aac`等。

### 生成一个PCM数据

了解了相关的音频信息后，我们可以尝试写入一个普通的正弦声波，我们是无法凭空生成一个音乐的，因为他们的声波不是规律的，我们无法直接拿到，因此我们生成一个正弦波的音频数据，然后再播放出来。首先，我们要确定波的参数，这里假定：采样率`44100Hz`，采样大小为`8bit`、振幅为`1`、频率为`100Hz`。

由此，我们可以模拟出对应的函数：`f(x) = 振幅 * sin(x / 采样率 * 频率)`，而生成`pcm`的数据就是不断的记录函数的值。这里假设生成一个`10s`的数据：

```
```









